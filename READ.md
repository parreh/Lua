All work done in lua.
